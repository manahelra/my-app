<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²Ù† ÙˆÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø³ÙˆÙ‚</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4361ee;
            --success-color: #2ec4b6;
            --danger-color: #e63946;
            --warning-color: #f8961e;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --bg-color: #f4f7fe;
            --text-color: #2b2d42;
            --card-bg: #ffffff;
            --border-color: #e0e0e0;
        }

        .dark-mode {
            --bg-color: #1a1a1a;
            --text-color: #f8f9fa;
            --card-bg: #2d2d2d;
            --border-color: #444;
            --light-color: #3d3d3d;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Tajawal', sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-color); padding: 20px; transition: 0.3s; }
        .container { max-width: 1300px; margin: 0 auto; background: var(--card-bg); padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        
        .tabs { display: flex; gap: 10px; border-bottom: 2px solid var(--border-color); margin-bottom: 20px; }
        .tab { padding: 12px 20px; cursor: pointer; border-radius: 8px 8px 0 0; font-weight: bold; color: #888; }
        .tab.active { background: var(--primary-color); color: white; }
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }

        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; background: var(--light-color); padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .input-field { display: flex; flex-direction: column; gap: 5px; }
        input, select, textarea { padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--card-bg); color: var(--text-color); }

        .search-area { position: relative; margin-bottom: 20px; display: flex; gap: 10px; }
        .search-area input { flex: 1; padding-right: 40px; height: 45px; font-size: 16px; border: 2px solid var(--primary-color); }
        .search-area i { position: absolute; right: 15px; top: 15px; color: var(--primary-color); }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: var(--primary-color); color: white; padding: 12px; text-align: right; }
        td { padding: 12px; border-bottom: 1px solid var(--border-color); }
        
        .btn { padding: 10px 18px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; display: inline-flex; align-items: center; gap: 5px; }
        .btn-add { background: var(--primary-color); color: white; }
        .btn-market { background: var(--success-color); color: white; }
        .btn-danger { background: var(--danger-color); color: white; }
        .btn-info { background: #4895ef; color: white; }

        .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; color: white; }
        .bg-market { background: #9b59b6; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @media print { .no-print { display: none !important; } .container { box-shadow: none; width: 100%; } }
    </style>
</head>
<body>

<div class="container">
    <header class="no-print">
        <h1><i class="fas fa-boxes"></i> Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø±</h1>
        <button onclick="toggleTheme()" class="btn btn-info" id="themeIcon"><i class="fas fa-moon"></i></button>
    </header>

    <div class="tabs no-print">
        <div class="tab active" onclick="showTab('inventory')">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</div>
        <div class="tab" onclick="showTab('market')">ğŸ›’ ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø³ÙˆÙ‚</div>
        <div class="tab" onclick="showTab('suppliers')">ğŸ¤ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</div>
    </div>

    <div id="inventory-tab" class="tab-content active">
        <div class="search-area no-print">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInventory" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù…ÙˆØ±Ø¯..." onkeyup="filterInventory()">
        </div>

        <div class="input-grid no-print">
            <div class="input-field"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label><input type="text" id="p-name"></div>
            <div class="input-field"><label>Ø§Ù„ÙƒÙ…ÙŠØ©</label><input type="number" id="p-qty" value="1"></div>
            <div class="input-field"><label>Ø³Ø¹Ø± Ø§Ù„ØªÙƒÙ„ÙØ©</label><input type="number" id="p-cost"></div>
            <div class="input-field"><label>Ø§Ù„Ù…ÙˆØ±Ø¯</label><select id="p-sup"></select></div>
            <div class="input-field" style="justify-content: flex-end;">
                <button class="btn btn-add" onclick="addToInventory()"><i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø®Ø²Ù†</button>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                    <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                    <th>Ø§Ù„ØªÙƒÙ„ÙØ©</th>
                    <th>Ø§Ù„Ù…ÙˆØ±Ø¯</th>
                    <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                    <th class="no-print">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody id="inventory-list"></tbody>
        </table>
    </div>

    <div id="market-tab" class="tab-content">
        <div class="no-print">
            <h3 style="margin-bottom: 15px; color: var(--success-color);">ØªØ³Ø¬ÙŠÙ„ ÙØ§ØªÙˆØ±Ø© Ø´Ø±Ø§Ø¡ Ù…Ù† Ø§Ù„Ø³ÙˆÙ‚</h3>
            <div class="input-grid">
                <div class="input-field"><label>Ø§Ù„ØºØ±Ø¶ / Ø§Ù„Ù…Ø§Ø¯Ø©</label><input type="text" id="m-item"></div>
                <div class="input-field"><label>Ø§Ù„ÙƒÙ…ÙŠØ©</label><input type="number" id="m-qty" value="1"></div>
                <div class="input-field"><label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label><input type="number" id="m-price"></div>
                <div class="input-field"><label>Ù…ÙƒØ§Ù† Ø§Ù„Ø´Ø±Ø§Ø¡</label><input type="text" id="m-place" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„ Ø£Ùˆ Ø§Ù„Ø³ÙˆÙ‚"></div>
                <div class="input-field" style="justify-content: flex-end;">
                    <button class="btn btn-market" onclick="addToMarket()"><i class="fas fa-shopping-cart"></i> Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
                </div>
            </div>
        </div>

        <div class="search-area no-print">
            <i class="fas fa-search"></i>
            <input type="text" id="searchMarket" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø³ÙˆÙ‚..." onkeyup="filterMarket()">
        </div>

        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                    <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                    <th>Ø§Ù„Ù…ÙƒØ§Ù†</th>
                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                    <th class="no-print">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody id="market-list"></tbody>
            <tfoot>
                <tr>
                    <td colspan="4" style="text-align: left; font-weight: bold;">Ù…Ø¬Ù…ÙˆØ¹ ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø³ÙˆÙ‚:</td>
                    <td id="market-total-sum" style="font-weight: bold; color: var(--danger-color);">0</td>
                    <td></td>
                </tr>
            </tfoot>
        </table>
    </div>

    <div id="suppliers-tab" class="tab-content">
        <div class="input-grid no-print">
            <div class="input-field"><label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯</label><input type="text" id="s-name"></div>
            <div class="input-field"><label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label><input type="text" id="s-phone"></div>
            <button class="btn btn-add" onclick="addSupplier()" style="margin-top: 25px;">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯</button>
        </div>
        <table>
            <thead><tr><th>Ø§Ù„Ù…ÙˆØ±Ø¯</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
            <tbody id="suppliers-list"></tbody>
        </table>
    </div>
</div>

<script>
    // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    let db = {
        inventory: JSON.parse(localStorage.getItem('inv_db')) || [],
        market: JSON.parse(localStorage.getItem('market_db')) || [],
        suppliers: JSON.parse(localStorage.getItem('sup_db')) || []
    };

    // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
    function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(tabId + '-tab').classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø®Ø²Ù†
    function addToInventory() {
        const name = document.getElementById('p-name').value;
        const qty = document.getElementById('p-qty').value;
        const cost = document.getElementById('p-cost').value;
        const sup = document.getElementById('p-sup').value;

        if(!name || !cost) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

        db.inventory.push({ name, qty, cost, sup, id: Date.now() });
        save();
        renderInventory();
        document.getElementById('p-name').value = '';
    }

    function renderInventory(data = db.inventory) {
        const list = document.getElementById('inventory-list');
        list.innerHTML = data.map((p, i) => `
            <tr>
                <td>${p.name}</td>
                <td>${p.qty}</td>
                <td>${p.cost}</td>
                <td><span class="badge bg-market">${p.sup || 'Ø¹Ø§Ù…'}</span></td>
                <td>${(p.qty * p.cost).toFixed(2)}</td>
                <td class="no-print">
                    <button class="btn btn-danger" onclick="deleteItem('inventory', ${i})"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
        `).join('');
    }

    // ÙˆØ¸Ø§Ø¦Ù ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø³ÙˆÙ‚
    function addToMarket() {
        const item = document.getElementById('m-item').value;
        const qty = document.getElementById('m-qty').value;
        const price = document.getElementById('m-price').value;
        const place = document.getElementById('m-place').value;
        const date = new Date().toLocaleDateString('ar-EG');

        if(!item || !price) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ§Ù„Ø³Ø¹Ø±");

        db.market.push({ item, qty, price, place, date, id: Date.now() });
        save();
        renderMarket();
        // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
        ['m-item', 'm-price', 'm-place'].forEach(id => document.getElementById(id).value = '');
    }

    function renderMarket(data = db.market) {
        const list = document.getElementById('market-list');
        let total = 0;
        list.innerHTML = data.map((m, i) => {
            total += parseFloat(m.price);
            return `
                <tr>
                    <td>${m.date}</td>
                    <td>${m.item}</td>
                    <td>${m.qty}</td>
                    <td>${m.place || 'Ø§Ù„Ø³ÙˆÙ‚'}</td>
                    <td>${parseFloat(m.price).toFixed(2)}</td>
                    <td class="no-print">
                        <button class="btn btn-danger" onclick="deleteItem('market', ${i})"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `}).join('');
        document.getElementById('market-total-sum').innerText = total.toFixed(2) + " Ø¯ÙŠÙ†Ø§Ø±";
    }

    // Ø§Ù„Ø¨Ø­Ø« (ÙÙ„ØªØ±Ø©)
    function filterInventory() {
        const val = document.getElementById('searchInventory').value.toLowerCase();
        const filtered = db.inventory.filter(p => 
            p.name.toLowerCase().includes(val) || (p.sup && p.sup.toLowerCase().includes(val))
        );
        renderInventory(filtered);
    }

    function filterMarket() {
        const val = document.getElementById('searchMarket').value.toLowerCase();
        const filtered = db.market.filter(m => 
            m.item.toLowerCase().includes(val) || (m.place && m.place.toLowerCase().includes(val))
        );
        renderMarket(filtered);
    }

    // Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
    function addSupplier() {
        const name = document.getElementById('s-name').value;
        if(!name) return;
        db.suppliers.push({ name, phone: document.getElementById('s-phone').value });
        save();
        renderSuppliers();
        document.getElementById('s-name').value = '';
    }

    function renderSuppliers() {
        const list = document.getElementById('suppliers-list');
        const select = document.getElementById('p-sup');
        list.innerHTML = db.suppliers.map((s, i) => `
            <tr><td>${s.name}</td><td>${s.phone}</td>
            <td><button class="btn btn-danger" onclick="deleteItem('suppliers', ${i})">Ø­Ø°Ù</button></td></tr>
        `).join('');
        select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù…ÙˆØ±Ø¯...</option>' + 
            db.suppliers.map(s => `<option value="${s.name}">${s.name}</option>`).join('');
    }

    // Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø­Ø°Ù
    function deleteItem(type, index) {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) {
            db[type].splice(index, 1);
            save();
            if(type === 'inventory') renderInventory();
            if(type === 'market') renderMarket();
            if(type === 'suppliers') renderSuppliers();
        }
    }

    function save() {
        localStorage.setItem('inv_db', JSON.stringify(db.inventory));
        localStorage.setItem('market_db', JSON.stringify(db.market));
        localStorage.setItem('sup_db', JSON.stringify(db.suppliers));
    }

    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        const isDark = document.body.classList.contains('dark-mode');
        document.getElementById('themeIcon').innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    }

    window.onload = () => {
        renderInventory();
        renderMarket();
        renderSuppliers();
    };
</script>

</body>
</html>